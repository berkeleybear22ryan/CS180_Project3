# Face Morphing and Mean Face Computation Project

### WEBSITE: https://berkeleybear22ryan.github.io/CS180_Project3/
### GITHUB: https://github.com/berkeleybear22ryan/CS180_Project3

## Overview

In this assignment, I produced a morph animation of my face transitioning into another person's face, computed the mean of a population of faces, and extrapolated from a population mean to create a caricature of myself. The project involved simultaneous warping of image shapes and a cross-dissolve of image colors, controlled by defining a correspondence between the two pictures.

The steps included:
1. Defining correspondences between facial landmarks in images.
2. Computing the "mid-way face" by averaging shapes and warping faces into this shape.
3. Creating a morph sequence transitioning from one face to another.
4. Computing the mean face of a population and warping my face and the population's mean face into each other's shapes.
5. Creating a caricature by extrapolating from the population mean.

## Part 1: Defining Correspondences

To define correspondences, I used annotated images with facial landmarks provided in `.asf` files. I wrote a tool in Python to read these keypoints and visualize them on the images. The keypoints were labeled consistently across all images to ensure a smooth morphing transition. I also computed the Delaunay triangulation on the midway shape (average of my face's points and the target face's points) to minimize triangle deformations during morphing.

**Outputs:**
- Generated images with annotated points and connections.
- Saved images in `./immface_exports/1/` and `./immface_exports/2/` directories for annotated overlays and blank point visualizations, respectively.

## Part 2: Computing the "Mid-way Face"

I computed the mid-way face between my image (A) and the target image (B) by:
1. Computing the average shape based on the corresponding points of the two images.
2. Warping both faces into this average shape using affine transformations for each triangle.
3. Averaging the colors of the two images to create a blended "mid-way face."

The affine transformations were calculated using a custom `computeAffine` function, and the face was warped by computing transformations for each triangle in the triangulation.

**Outputs:**
- The original images A and B.
- The mid-way face image showing the average shape and blended colors.

## Part 3: The Morph Sequence

To create the morph sequence, I implemented a function:

```python
morphed_im = morph(im1, im2, im1_pts, im2_pts, tri, warp_frac, dissolve_frac)
```

The function controls the warp between two images (`im1` and `im2`) using point correspondences (`im1_pts` and `im2_pts`) and the triangulation (`tri`). The `warp_frac` and `dissolve_frac` parameters control the shape warping and cross-dissolve, respectively.

**Procedure:**
- Each frame is generated by varying the `warp_frac` and `dissolve_frac` parameters incrementally from 0 to 1.
- The starting frame (0) is identical to image A, and the ending frame (45) is identical to image B.

**Output:**
- A sequence of 45 frames, creating a morph video from image A to image B. The video is displayed at 30 frames per second (fps).

## Part 4: The "Mean Face" of a Population

I used the Danes dataset, containing annotated faces, to compute the mean face shape of the population. Hereâ€™s how I proceeded:

1. **Computing the Average Face Shape**:
   - Collected facial keypoints from all images in the dataset and computed the mean of these points to get the average face shape.
   - Visualized this shape both with and without annotations and saved them in `./immface_exports/5/`.

2. **Morphing Faces into the Average Shape**:
   - Warped each face in the dataset to match the average shape using the Delaunay triangulation and affine transformations.
   - Saved before-and-after images (side by side) for each face in `./immface_exports/6/`.

3. **Computing the Average Face of the Population**:
   - Blended all the morphed faces into a single image to represent the average face of the population.
   - Saved the average face image (both annotated and unannotated) in `./immface_exports/5/`.

4. **Morphing My Face to the Average Geometry**:
   - Warped my reference image into the average geometry of the population.
   - Warped the population's average face into the geometry of my face.
   - Saved the morphed images.

**Outputs:**
- Average face shape, average face population image, morphed examples, and transformations of my face and the average.

## Part 5: Caricatures: Extrapolating from the Mean

I produced a caricature of my face by extrapolating from the population mean. This was done by exaggerating the difference between my face and the population mean geometry. I adjusted the landmarks in my face image to create an exaggerated or "caricatured" version, making the result visually distinct from both my face and the average.

## Additional Implementation Details

### Noise Reduction and Sharpening
To enhance the morphing effect, I applied sharpening filters to the images before morphing. This process helped remove low-frequency noise, ensuring the details in the face features were preserved and emphasized in the morphing process.

### Dataset Details
I used 93 high-resolution images from the **Martin Schoeller** collection as the target dataset. The triangulation moved dynamically with the points as the morph progressed, maintaining consistency across frames.

## Dependencies

To run the project, ensure the following libraries are installed:
- Python 3.x
- OpenCV
- NumPy
- SciPy

## How to Run

1. Clone the project and navigate to the project directory.
2. Install required libraries:
   ```
   pip install numpy opencv-python scipy
   ```
3. Place the dataset images and their annotation files in the `imm_face_db/` directory.
4. Ensure your reference face image is placed in `images_2/` with the corresponding `.asf` file.
5. Run the scripts (in order):
   ```
   python a_start1.py
   python a_start2.py
   python a_start3.py
   python a_start4.py
   python a_start5.py
   ```

## Conclusion and Future Work

This project demonstrates facial morphing, mean face computation, and caricature generation. Potential future work includes:
- Expanding the dataset to include various demographic subgroups for more targeted mean face calculations.
- Implementing a real-time interface for live face morphing.
- Incorporating other advanced morphing techniques like thin-plate splines for improved transformation flexibility.